<!DOCTYPE html>
<html style="font-size: 16px;" lang="it"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>Monitoraggio Sensori</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
<link rel="stylesheet" href="Monitoraggio-Sensori.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
    
    <link rel="icon" href="images/1613421702253.jpeg">
    <link id="u-theme-google-font" rel="stylesheet" href="fonts.css">
    
    
    
    
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": "Site2",
		"logo": "images/marconi.png"
}</script>
    <meta name="theme-color" content="#4551dd">
    <meta property="og:title" content="Monitoraggio Sensori">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
  <meta data-intl-tel-input-cdn-path="intlTelInput/"></head>
  <body data-path-to-root="./" class="u-body u-xl-mode" data-lang="it"><header class="u-clearfix u-header" id="sec-fe69"><div class="u-clearfix u-sheet u-sheet-1">
        <a href="https://nicepage.com" class="u-image u-logo u-image-1" data-image-width="503" data-image-height="499">
          <img src="images/marconi.png" class="u-logo-image u-logo-image-1">
        </a>
        <nav class="u-align-left u-font-size-14 u-menu u-menu-one-level u-nav-spacing-25 u-menu-1" data-responsive-from="MD" data-position="Menu">
          <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px; font-weight: 700;">
            <a class="u-button-style u-custom-active-color u-custom-border u-custom-border-color u-custom-borders u-custom-color u-custom-hover-color u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-text-active-color u-custom-text-color u-custom-text-hover-color u-custom-text-shadow u-custom-top-bottom-menu-spacing u-nav-link u-palette-1-base" href="#" style="padding: 11px 4px; font-size: calc(1em + 22px); background-image: none;">
              <svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 302 302" style=""><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-7b92"></use></svg>
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="svg-7b92" x="0px" y="0px" viewBox="0 0 302 302" style="enable-background:new 0 0 302 302;" xml:space="preserve" class="u-svg-content"><g><rect y="36" width="302" height="30"></rect><rect y="236" width="302" height="30"></rect><rect y="136" width="302" height="30"></rect>
</g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>
            </a>
          </div>
          <div class="u-custom-menu u-nav-container">
            <ul class="u-nav u-spacing-20 u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-white u-text-body-alt-color u-text-hover-palette-2-base" href="Home.html" style="padding: 10px;">Home</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-white u-text-body-alt-color u-text-hover-palette-2-base" href="Monitoraggio-Sensori.html" style="padding: 10px;">Monitoraggio Sensori</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-white u-text-body-alt-color u-text-hover-palette-2-base" href="https://www.marconicivitavecchia.it/" target="_blank" style="padding: 10px;">La scuola</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-white u-text-body-alt-color u-text-hover-palette-2-base" href="mailto:makerfaire@marconicloud.it?subject=Informazioni" style="padding: 10px;">Contatti</a>
</li></ul>
          </div>
          <div class="u-custom-menu u-nav-container-collapse">
            <div class="u-align-center u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
              <div class="u-inner-container-layout u-sidenav-overflow">
                <div class="u-menu-close"></div>
                <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Home.html">Home</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Monitoraggio-Sensori.html">Monitoraggio Sensori</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="https://www.marconicivitavecchia.it/" target="_blank">La scuola</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="mailto:makerfaire@marconicloud.it?subject=Informazioni">Contatti</a>
</li></ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
          </div>
        </nav>
      </div></header>
    <section class="u-clearfix u-section-1" id="sec-2335">
      <div class="u-clearfix u-sheet u-sheet-1">
        <h4 class="u-text u-text-body-alt-color u-text-default u-text-1">Monitoraggio Sensori</h4>
      </div>
    </section>
    <section class="u-clearfix u-section-2" id="sec-5022">
      <div class="u-clearfix u-sheet u-sheet-1">
        <div class="u-expanded-width u-list u-list-1">
          <div class="u-repeater u-repeater-1">
            <div class="u-container-style u-custom-item u-list-item u-palette-1-base u-repeater-item u-list-item-1">
              <div class="u-container-layout u-similar-container u-container-layout-1">
                <div class="custom-expanded u-clearfix u-custom-html u-custom-html-1">
                  <style> <h1 id="sensore1">85</h1>
	
</div></div></style>
                </div>
                <h5 class="u-text u-text-default u-text-1"><span class="u-file-icon u-icon u-icon-1"><img src="images/2803626.png" alt=""></span>&nbsp;Sensore 1
                </h5>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-2">
                  <style></style>
                  <p>Co2</p>
                  <h1 id="sensore0:2">11</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-3">
                  <style></style>
                  <p>TVOC </p>
                  <h1 id="sensore0:3">11</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-4">
                  <style></style>
                  <p>Pm 2,5</p>
                  <h1 id="sensore0:5">3</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-5">
                  <style></style>
                  <p>Pressione</p>
                  <h1 id="sensore0:0">99</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-6">
                  <style></style>
                  <p>Temperatura</p>
                  <h1 id="sensore0:1">20</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-7">
                  <style></style>
                  <p>Pm 10</p>
                  <h1 id="sensore0:4">80</h1>
                </div>
                <h5 class="u-text u-text-default u-text-2"><span class="u-file-icon u-icon u-icon-2"><img src="images/2803626.png" alt=""></span>&nbsp;Sensore 2
                </h5>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-8">
                  <style></style>
                  <p>Co2</p>
                  <h1 id="sensore1:2">11</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-9">
                  <style></style>
                  <p>Pm 10</p>
                  <h1 id="sensore1:4">80</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-10">
                  <style></style>
                  <p>TVOC </p>
                  <h1 id="sensore1:3">11</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-11">
                  <style></style>
                  <p>Pm 2,5</p>
                  <h1 id="sensore1:5">3</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-12">
                  <style></style>
                  <p>Pressione</p>
                  <h1 id="sensore1:0">54</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-13">
                  <style></style>
                  <p>Temperatura</p>
                  <h1 id="sensore1:1">20</h1>
                </div>
                <h5 class="u-text u-text-default u-text-3"><span class="u-file-icon u-icon u-icon-3"><img src="images/2803626.png" alt=""></span>&nbsp;Sensore 3
                </h5>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-14">
                  <style></style>
                  <p>Co2</p>
                  <h1 id="sensore2:2">11</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-15">
                  <style></style>
                  <p>TVOC</p>
                  <h1 id="sensore2:3">11</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-16">
                  <style></style>
                  <p>Pm 10</p>
                  <h1 id="sensore2:4">80</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-17">
                  <style></style>
                  <p>Pm 2,5</p>
                  <h1 id="sensore2:5">3</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-18">
                  <style></style>
                  <p>Pressione</p>
                  <h1 id="sensore2:0">54</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-19">
                  <style></style>
                  <p>Temperatura</p>
                  <h1 id="sensore2:1">20</h1>
                </div>
                <h5 class="u-text u-text-default u-text-4"><span class="u-file-icon u-icon u-icon-4"><img src="images/2803626.png" alt=""></span>&nbsp;Sensore 4
                </h5>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-20">
                  <style></style>
                  <p>Pressione</p>
                  <h1 id="sensore3:0">54</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-21">
                  <style></style>
                  <p>Temperatura</p>
                  <h1 id="sensore3.1">20</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-22">
                  <style></style>
                  <p>Co2</p>
                  <h1 id="sensore3.2">11</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-23">
                  <style></style>
                  <p>TVOC</p>
                  <h1 id="sensore3:3">11</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-24">
                  <style></style>
                  <p>Pm 10</p>
                  <h1 id="sensore3:4">80</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-25">
                  <style></style>
                  <p>Pm 2,5</p>
                  <h1 id="sensore3:5">3</h1>
                </div>
                <h5 class="u-text u-text-default u-text-5"><span class="u-file-icon u-icon u-icon-5"><img src="images/2803626.png" alt=""></span>&nbsp;Sensore 5
                </h5>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-26">
                  <style></style>
                  <p>Pressione</p>
                  <h1 id="sensore4:0">54</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-27">
                  <style></style>
                  <p>Temperatura</p>
                  <h1 id="sensore4:1">20</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-28">
                  <style></style>
                  <p>Co2</p>
                  <h1 id="sensore4:2">11</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-29">
                  <style></style>
                  <p>TVOC</p>
                  <h1 id="sensore4:2">11</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-30">
                  <style></style>
                  <p>Pm 10</p>
                  <h1 id="sensore4:3">80</h1>
                </div>
                <div class="custom-expanded u-clearfix u-custom-html u-palette-1-base u-custom-html-31">
                  <style></style>
                  <p>Pm 2,5</p>
                  <h1 id="sensore4:4">3</h1>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.2/mqttws31.min.js' type='text/javascript'></script>"
    <script>
	//-----------------------------------------------------------------------------------
	// Client MQTT
	//------------------------------------------------------------------------------------		
	// Create a client instance
		var conn;
		start();
		function start(){
			var clientID = 'antennone_' + parseInt(Math.random() * 100);
			conn = new Paho.MQTT.Client('marconicloud.it', 8884, '/', clientID);
			//"var conn = new Paho.MQTT.Client('{MA}', Number('{MT}'), clientID);"
			console.log(conn);
			console.log('broker: marconicloud.it, port:8884, path: /, id:'+clientID);
			// connect the client
			conn.connect(
				{
					cleanSession : false,
					onSuccess : onConnect,
					onFailure : onFailed,
					keepAliveInterval: 30
				});
			function onFailed() {
				//conn.send('Connect ' + new Date());"
				console.log('Initial connect request failed. Error message : ' + err.errorMessage);
			};
			function onConnect(resObj) {
				//"conn.send('Connect ' + new Date());"
				console.log('onConnect');
				conn.subscribe('{MO}');
				console.log('Connected to ' + resObj.uri);
				if (resObj.reconnect){
					console.log('It was a result of automatic reconnect.');
				}
			};
			conn.onMessageArrived = function (e) {
				var obj = JSON.parse(e.payloadString);
				/*if(obj.devid=='{IV}'||obj.devid=='FF'){*/
					console.log('Received: '+e.payloadString);
					onRcv(e.payloadString);
				/*if}"*/
			};
			conn.onConnectionLost  = function (resObj) {			
				console.log('Lost connection to ' + resObj.uri + ' Error code: ' + resObj.errorCode + ' Error text: ' + resObj.errorMessage);
				if (resObj.reconnect){
					console.log('Automatic reconnect is currently active.');
				}else{"
					console.log('Lost connection to host, reconnect in 5 seconds');
					// Try to reconnect in 5 seconds
					setTimeout(function(){start()}, 5000);
				}"
			};
		};
		function send(str){
		    console.log('send: '+str);
			var msg = new Paho.MQTT.Message(str);
			msg.destinationName = '{QI}';
			console.log('topic: '+msg.destinationName);
			conn.send(msg);
		};
		function condsend(arr,i,eid,cs){
			var el=document.getElementById(eid);
			var c=arr[i].replace(cs, el.value.trim());
			send(c);
			console.log('condsend: '+c);
		};
		function actsend(jsn,str,cs){
			var v=jsn.replace(cs, str.trim());
			console.log('actsend: '+v+'-subwith:'+str.trim()+'-cs:'+cs);
			send(v);
		};
		function press(s){
			send(s);
		};
//------------------------------------------------------------------
// gestione comandi in ingresso
//------------------------------------------------------------------
	var currID;
	var currSensor;
	//cmd callback
	function onRcv(d) {
		//document.getElementById('p').innerHTML = f.data;\n"
		let obj = JSON.parse(d);
		//delete obj.utc1; // remove this field
		//delete obj.isoDateString; // remove this field
		console.log('Arrived data');
		for(x in obj){
			currSensor = -1;
			console.log('x:'+x);
			if(x == 'sensorID'){
				currID = obj[x];// indice di riga
				console.log('currID:'+currID);
				//var grpNode = grpContainer.querySelector("[data-grp='"+currGrp+"']");// get target group
			}else if(x == 'pm10'){
				currSensor = 4;
			}else if(x == 'pm25'){
				currSensor = 5;
			}else if(x == 'tvoc'){
				currSensor = 3;
			}else if(x == 'co2'){
				currSensor = 2;
			}else if(x == 'temp'){
				currSensor = 1;
			}else if(x == 'press'){
				currSensor = 0;
			}
			if(currSensor >= 0){
				let key = "sensore"+currID+":"+currSensor;
				let el = document.getElementById(key);
				el.innerHTML = Number(obj[x]);
			}else{
				//{"devid":"pippo","on1":"0","sp1":"10000","tr1":"50"}
				//{"devid":"pippo","on1":"1","sp1":"10000","tr1":"10","pr1":"10"}
				//errori nel json staccano la connessione!!
			};
		}
	}	
	/*
	 {
		  utc2000: utc1,
		  isodate: isoDateString,
		  date: DateString,
		  sensorID: id,
		  pm10: pm10,
		  pm25: pm25,
		  tvoc: 45,
		  co2: 50,
		  temp: 34,
		  press: 100
	 };
	*/
	</script>
  
  
</body></html>
